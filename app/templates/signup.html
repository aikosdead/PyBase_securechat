{% extends "base.html" %}
{% block content %}
<div class="auth-wrapper">
  <div class="auth-card">
    <h2>Create Your Account</h2>

    <form id="signup-form" method="POST" action="{{ url_for('auth.signup') }}" enctype="multipart/form-data">
      <div class="input-group">
        <label for="email">Email</label>
        <input type="text" name="email" id="email" placeholder="Enter Email" required />
      </div>

      <div class="input-group">
        <label for="username">Username</label>
        <input type="text" name="username" id="username" placeholder="Enter username" required />
      </div>

      <div class="input-group">
        <label for="password">Password</label>
        <input type="password" name="password" id="password" placeholder="Enter password" required />
      </div>

      <div class="input-group">
        <label for="avatar">Profile Picture</label>
        <input type="file" name="avatar" id="avatar" accept="image/*" onchange="previewAvatar(event)" />
        <img id="avatar-preview" src="{{ url_for('static', filename='img/default-avatar.png') }}" alt="Avatar preview" class="avatar-preview" />
      </div>

      <input type="hidden" name="public_key" id="public_key" />

      <button class="btn" type="submit">Sign Up</button>
    </form>

    <p class="switch">
      Already have an account?
      <a href="{{ url_for('auth.login') }}">Log in</a>
    </p>

    {% if error %}
      <p class="error">{{ error }}</p>
    {% endif %}
  </div>
</div>

<script>
  function previewAvatar(event) {
    const reader = new FileReader();
    reader.onload = function () {
      document.getElementById('avatar-preview').src = reader.result;
    };
    if (event.target.files[0]) {
      reader.readAsDataURL(event.target.files[0]);
    }
  }
</script>

<script type="module" src="{{ url_for('static', filename='js/signup-init.js') }}"></script>

<style>
  .avatar-preview {
    display: block;
    margin-top: 10px;
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 50%;
    border: 1px solid #ccc;
  }
</style>
{% endblock %}
